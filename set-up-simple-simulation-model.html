<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Set up simple simulation model | Inference in infectious disease systems practicals</title>
  <meta name="description" content="2 Set up simple simulation model | Inference in infectious disease systems practicals" />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Set up simple simulation model | Inference in infectious disease systems practicals" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="2 Set up simple simulation model | Inference in infectious disease systems practicals" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Set up simple simulation model | Inference in infectious disease systems practicals" />
  
  <meta name="twitter:description" content="2 Set up simple simulation model | Inference in infectious disease systems practicals" />
  

<meta name="author" content="TJ McKinley" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="approximate-bayesian-computation.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script language="javascript"> 
    function toggle(id) {
        var ele = document.getElementById("toggleText" + id);
        var text = document.getElementById("displayText" + id);
        var buttonText = text.innerHTML.replace("Show ", "");
        buttonText = buttonText.replace("Hide ", "");
        if(ele.style.display == "block") {
            ele.style.display = "none";
            text.innerHTML = "Show " + buttonText;
        } else {
            ele.style.display = "block";
            text.innerHTML = "Hide " + buttonText;
        }
    } 
</script>

<script language="javascript">
    function openCode(evt, codeName, id) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent" + id);
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        tablinks = document.getElementsByClassName("tablinks" + id);
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(codeName).style.display = "block";
        evt.currentTarget.className += " active";
    }
</script>

<script language="javascript">
    function hide(id){
        document.getElementById(id).style.display = "none";
    }
</script>
</script>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#installation"><i class="fa fa-check"></i><b>1.1</b> Installation</a><ul>
<li class="chapter" data-level="1.1.1" data-path="index.html"><a href="index.html#windows"><i class="fa fa-check"></i><b>1.1.1</b> Windows</a></li>
<li class="chapter" data-level="1.1.2" data-path="index.html"><a href="index.html#mac"><i class="fa fa-check"></i><b>1.1.2</b> Mac</a></li>
<li class="chapter" data-level="1.1.3" data-path="index.html"><a href="index.html#linux"><i class="fa fa-check"></i><b>1.1.3</b> Linux</a></li>
<li class="chapter" data-level="1.1.4" data-path="index.html"><a href="index.html#install-package"><i class="fa fa-check"></i><b>1.1.4</b> Install package</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="set-up-simple-simulation-model.html"><a href="set-up-simple-simulation-model.html"><i class="fa fa-check"></i><b>2</b> Set up simple simulation model</a><ul>
<li class="chapter" data-level="2.1" data-path="set-up-simple-simulation-model.html"><a href="set-up-simple-simulation-model.html#case-study"><i class="fa fa-check"></i><b>2.1</b> Case Study</a></li>
<li class="chapter" data-level="2.2" data-path="set-up-simple-simulation-model.html"><a href="set-up-simple-simulation-model.html#set-up-simulation-model"><i class="fa fa-check"></i><b>2.2</b> Set up simulation model</a></li>
<li class="chapter" data-level="2.3" data-path="set-up-simple-simulation-model.html"><a href="set-up-simple-simulation-model.html#using-tspan"><i class="fa fa-check"></i><b>2.3</b> Using <code>tspan</code></a></li>
<li class="chapter" data-level="2.4" data-path="set-up-simple-simulation-model.html"><a href="set-up-simple-simulation-model.html#plotting-simulations"><i class="fa fa-check"></i><b>2.4</b> Plotting simulations</a></li>
<li class="chapter" data-level="2.5" data-path="set-up-simple-simulation-model.html"><a href="set-up-simple-simulation-model.html#running-multiple-simulations"><i class="fa fa-check"></i><b>2.5</b> Running multiple simulations</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="approximate-bayesian-computation.html"><a href="approximate-bayesian-computation.html"><i class="fa fa-check"></i><b>3</b> Approximate Bayesian Computation</a><ul>
<li class="chapter" data-level="3.1" data-path="approximate-bayesian-computation.html"><a href="approximate-bayesian-computation.html#simulation-model"><i class="fa fa-check"></i><b>3.1</b> Simulation model</a></li>
<li class="chapter" data-level="3.2" data-path="approximate-bayesian-computation.html"><a href="approximate-bayesian-computation.html#arguments-to-abcsmc-function"><i class="fa fa-check"></i><b>3.2</b> Arguments to <code>ABCSMC()</code> function</a><ul>
<li class="chapter" data-level="3.2.1" data-path="approximate-bayesian-computation.html"><a href="approximate-bayesian-computation.html#summary-statistics"><i class="fa fa-check"></i><b>3.2.1</b> Summary statistics</a></li>
<li class="chapter" data-level="3.2.2" data-path="approximate-bayesian-computation.html"><a href="approximate-bayesian-computation.html#priors"><i class="fa fa-check"></i><b>3.2.2</b> Prior distributions</a></li>
<li class="chapter" data-level="3.2.3" data-path="approximate-bayesian-computation.html"><a href="approximate-bayesian-computation.html#simulation-function"><i class="fa fa-check"></i><b>3.2.3</b> Simulation function</a></li>
<li class="chapter" data-level="3.2.4" data-path="approximate-bayesian-computation.html"><a href="approximate-bayesian-computation.html#inistates"><i class="fa fa-check"></i><b>3.2.4</b> Initial states</a></li>
<li class="chapter" data-level="3.2.5" data-path="approximate-bayesian-computation.html"><a href="approximate-bayesian-computation.html#tolerances"><i class="fa fa-check"></i><b>3.2.5</b> Tolerances</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="approximate-bayesian-computation.html"><a href="approximate-bayesian-computation.html#running-abcsmc"><i class="fa fa-check"></i><b>3.3</b> Running <code>ABCSMC()</code></a></li>
<li class="chapter" data-level="3.4" data-path="approximate-bayesian-computation.html"><a href="approximate-bayesian-computation.html#calculate-posterior-for-transformations-of-parameters"><i class="fa fa-check"></i><b>3.4</b> Calculate posterior for transformations of parameters</a></li>
<li class="chapter" data-level="3.5" data-path="approximate-bayesian-computation.html"><a href="approximate-bayesian-computation.html#adding-additional-matching-criteria"><i class="fa fa-check"></i><b>3.5</b> Adding additional matching criteria</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="example-abakaliki-smallpox-outbreak.html"><a href="example-abakaliki-smallpox-outbreak.html"><i class="fa fa-check"></i><b>4</b> Example: Abakaliki smallpox outbreak</a><ul>
<li class="chapter" data-level="4.1" data-path="example-abakaliki-smallpox-outbreak.html"><a href="example-abakaliki-smallpox-outbreak.html#sir-model"><i class="fa fa-check"></i><b>4.1</b> SIR model</a></li>
<li class="chapter" data-level="4.2" data-path="example-abakaliki-smallpox-outbreak.html"><a href="example-abakaliki-smallpox-outbreak.html#summary-statistics-1"><i class="fa fa-check"></i><b>4.2</b> Summary statistics</a></li>
<li class="chapter" data-level="4.3" data-path="example-abakaliki-smallpox-outbreak.html"><a href="example-abakaliki-smallpox-outbreak.html#simulation-model-1"><i class="fa fa-check"></i><b>4.3</b> Simulation model</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="particle-mcmc.html"><a href="particle-mcmc.html"><i class="fa fa-check"></i><b>5</b> Particle MCMC</a><ul>
<li class="chapter" data-level="5.1" data-path="particle-mcmc.html"><a href="particle-mcmc.html#arguments-for-pmcmc-function"><i class="fa fa-check"></i><b>5.1</b> Arguments for <code>PMCMC()</code> function</a><ul>
<li class="chapter" data-level="5.1.1" data-path="particle-mcmc.html"><a href="particle-mcmc.html#data"><i class="fa fa-check"></i><b>5.1.1</b> Data</a></li>
<li class="chapter" data-level="5.1.2" data-path="particle-mcmc.html"><a href="particle-mcmc.html#obsprocess"><i class="fa fa-check"></i><b>5.1.2</b> Observation process</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="particle-mcmc.html"><a href="particle-mcmc.html#running-the-pmcmc-algorithm"><i class="fa fa-check"></i><b>5.2</b> Running the PMCMC algorithm</a></li>
<li class="chapter" data-level="5.3" data-path="particle-mcmc.html"><a href="particle-mcmc.html#optimising-the-number-of-particles"><i class="fa fa-check"></i><b>5.3</b> Optimising the number of particles</a></li>
<li class="chapter" data-level="5.4" data-path="particle-mcmc.html"><a href="particle-mcmc.html#visualising-and-summarising-the-posterior-distributions"><i class="fa fa-check"></i><b>5.4</b> Visualising and summarising the posterior distributions</a></li>
<li class="chapter" data-level="5.5" data-path="particle-mcmc.html"><a href="particle-mcmc.html#predictive-posterior-distributions"><i class="fa fa-check"></i><b>5.5</b> Predictive posterior distributions</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="epilogue.html"><a href="epilogue.html"><i class="fa fa-check"></i><b>6</b> Epilogue</a></li>
<li class="chapter" data-level="7" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>7</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Inference in infectious disease systems practicals</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="set-up-simple-simulation-model" class="section level1">
<h1><span class="header-section-number">2</span> Set up simple simulation model</h1>
<p>This chapter is to illustrate how to use <code>mparseRcpp</code> to simulate from a simple epidemic model. To start with we introduce a simple case study system. Before we do that, load the <code>SimBIID</code> and <a href="http://www.repidemicsconsortium.org/outbreaks/index.html"><code>outbreaks</code></a> packages (the latter containing the data).</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co">## load libraries</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw">library</span>(SimBIID)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="kw">library</span>(outbreaks)</a></code></pre></div>
<div id="case-study" class="section level2">
<h2><span class="header-section-number">2.1</span> Case Study</h2>
<p>To illustrate some of these ideas we will use a case study of influenza in a boarding school. These data are from a paper in the BMJ in 1978 <span class="citation">(Anonymous <a href="#ref-anonymous:1978">1978</a>)</span> and provided in the <a href="http://www.repidemicsconsortium.org/outbreaks/index.html"><code>outbreaks</code></a> R package. We use a simple <span class="math inline">\(SIRR_1\)</span> model with two removal classes, <span class="math inline">\(R\)</span> and <span class="math inline">\(R_1\)</span>. We will assume that the bed-rest counts in the data correspond to the number of individuals in the <span class="math inline">\(R\)</span> class, and will ignore the other time-series for the time being. This has been used various times in the literature, including <span class="citation">Murray (<a href="#ref-murray:2003">2003</a>)</span>, <span class="citation">de Vries et al. (<a href="#ref-devriesetal:2006">2006</a>)</span> and in some of the <a href="https://kingaa.github.io/sbied/mif/mif.html#an-iterated-filtering-algorithm-if2"><code>pomp</code> tutorials</a>. The stochastic model we will use has event probabilities:
<span class="math display">\[\begin{align*}
    P\left[S_{t + \delta t} = S_t - 1, I_{t + \delta t} = I_t + 1\right] &amp;\approx \beta S I / N\\
    P\left[I_{t + \delta t} = I_t - 1, R_{t + \delta t} = R_t + 1\right] &amp;\approx \gamma I\\
    P\left[R_{t + \delta t} = R_t - 1, R_{1, t + \delta t} = R_{1,t} + 1\right] &amp;\approx \gamma_1 R
\end{align*}\]</span>
The initial population size is 763 pupils, and we assume an initial introduction of infection of a single individual at day 0.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co">## extract data from &#39;outbreaks&#39;</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">flu &lt;-<span class="st"> </span>influenza_england_<span class="dv">1978</span>_school</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">flu<span class="op">$</span>day &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(flu)</a></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co">## plot data</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="kw">plot</span>(flu<span class="op">$</span>day, flu<span class="op">$</span>in_bed, <span class="dt">xlab =</span> <span class="st">&quot;Day&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Number in bed-rest&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>)</a></code></pre></div>
<p><img src="_main_files/figure-html/plot-BS-1.svg" width="60%" style="display: block; margin: auto;" /></p>
</div>
<div id="set-up-simulation-model" class="section level2">
<h2><span class="header-section-number">2.2</span> Set up simulation model</h2>
<p>To set up the model above we need a character vector of transition rates:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co">## set up transition rates</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">transitions &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">    <span class="st">&quot;S -&gt; beta * S * I / (S + I + R + R1) -&gt; I&quot;</span>, </a>
<a class="sourceLine" id="cb6-4" data-line-number="4">    <span class="st">&quot;I -&gt; gamma * I -&gt; R&quot;</span>,</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">    <span class="st">&quot;R -&gt; gamma1 * R -&gt; R1&quot;</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6">)</a></code></pre></div>
<p>We also need a vector of compartment names and parameter names:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co">## set compartment and parameter names</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2">compartments &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;S&quot;</span>, <span class="st">&quot;I&quot;</span>, <span class="st">&quot;R&quot;</span>, <span class="st">&quot;R1&quot;</span>)</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">pars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;beta&quot;</span>, <span class="st">&quot;gamma&quot;</span>, <span class="st">&quot;gamma1&quot;</span>)</a></code></pre></div>
<p>We then build a model using the <code>mparseRcpp()</code>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="co">## parse model</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">model &lt;-<span class="st"> </span><span class="kw">mparseRcpp</span>(</a>
<a class="sourceLine" id="cb8-3" data-line-number="3">    <span class="dt">transitions =</span> transitions, </a>
<a class="sourceLine" id="cb8-4" data-line-number="4">    <span class="dt">compartments =</span> compartments,</a>
<a class="sourceLine" id="cb8-5" data-line-number="5">    <span class="dt">pars =</span> pars</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">)</a></code></pre></div>
<blockquote>
<p>If you wish to, you can view the parsed <code>Rcpp</code> source code by simply printing the object e.g.</p>
<pre><code>model</code></pre>
</blockquote>
<p>The <code>SimBIID</code> package provides a <code>run()</code> method to run individual or multiple simulations from the model. By default the <code>mparseRcpp</code> creates a function that takes four arguments:</p>
<ul>
<li><code>pars</code>: a vector of parameter values;</li>
<li><code>tstart</code>: the time to begin the simulation;</li>
<li><code>tstop</code>: the time to end the simulation;</li>
<li><code>u</code>: states of the system at <code>tstart</code>.</li>
</ul>
<p>We can then pass this object to the <code>run()</code> method, along with the corresponding arguments e.g.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="co">## define parameters</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2">simPars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">beta =</span> <span class="fl">2.5</span>, <span class="dt">gamma =</span> <span class="dv">1</span>, <span class="dt">gamma1 =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb10-3" data-line-number="3"></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="co">## define initial states</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5">iniStates &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">S =</span> <span class="dv">762</span>, <span class="dt">I =</span> <span class="dv">1</span>, <span class="dt">R =</span> <span class="dv">0</span>, <span class="dt">R1 =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb10-6" data-line-number="6"></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="co">## run model</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8">sims &lt;-<span class="st"> </span><span class="kw">run</span>(</a>
<a class="sourceLine" id="cb10-9" data-line-number="9">    <span class="dt">model =</span> model,</a>
<a class="sourceLine" id="cb10-10" data-line-number="10">    <span class="dt">pars =</span> simPars,</a>
<a class="sourceLine" id="cb10-11" data-line-number="11">    <span class="dt">tstart =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb10-12" data-line-number="12">    <span class="dt">tstop =</span> <span class="dv">15</span>,</a>
<a class="sourceLine" id="cb10-13" data-line-number="13">    <span class="dt">u =</span> iniStates</a>
<a class="sourceLine" id="cb10-14" data-line-number="14">)</a>
<a class="sourceLine" id="cb10-15" data-line-number="15">sims</a></code></pre></div>
<pre><code>## &#39;SimBIID_runs&#39; object with n = 1 replicates.
## 
## Output at final time point:
## # A tibble: 1 x 6
##   completed     t     S     I     R    R1
##       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1         1  13.7    75     0     0   688</code></pre>
<p>Currently this outputs a <code>tibble</code> object (essentially a <code>data.frame</code>), with columns: <code>completed / t / u*</code>, where <code>completed</code> is a binary variable containing the value <code>1</code> if the epidemic finished before time point <code>tstop</code>, and <code>0</code> otherwise. Then the value <code>t</code> is the time point when the epidemic finished (or <code>tstop</code> if the epidemic was still ongoing when the function exited), and I’m using <code>u*</code> generically to correspond to a copy of the states of the system at the final time point (here <span class="math inline">\(S\)</span>, <span class="math inline">\(I\)</span>, <span class="math inline">\(R\)</span> and <span class="math inline">\(R_1\)</span>).</p>
<p>Here we can see that the simulation finished at time point <code>t = 13.73</code>, with the final state of the system given by <code>c(S = 75, I = 0, R = 0, R1 = 688)</code>.</p>
</div>
<div id="using-tspan" class="section level2">
<h2><span class="header-section-number">2.3</span> Using <code>tspan</code></h2>
<p>Alternatively, we may want to return the states of the system at a series of pre-determined points. We can do this by adding a <code>tspan</code> argument, which is a vector of time points at which we wish to return the states. We initialise the model by telling <code>mparseRcpp</code> that we wish to include a <code>tspan</code> argument e.g.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="co">## parse model</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2">model &lt;-<span class="st"> </span><span class="kw">mparseRcpp</span>(</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">    <span class="dt">transitions =</span> transitions, </a>
<a class="sourceLine" id="cb12-4" data-line-number="4">    <span class="dt">compartments =</span> compartments,</a>
<a class="sourceLine" id="cb12-5" data-line-number="5">    <span class="dt">pars =</span> pars,</a>
<a class="sourceLine" id="cb12-6" data-line-number="6">    <span class="dt">tspan =</span> T</a>
<a class="sourceLine" id="cb12-7" data-line-number="7">)</a></code></pre></div>
<p>When we <code>run()</code> the model, we can enter a suitable <code>tspan</code> argument as a vector of time points at which we wish to return the states e.g.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="co">## run model</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2">sims &lt;-<span class="st"> </span><span class="kw">run</span>(</a>
<a class="sourceLine" id="cb13-3" data-line-number="3">    <span class="dt">model =</span> model,</a>
<a class="sourceLine" id="cb13-4" data-line-number="4">    <span class="dt">pars =</span> simPars,</a>
<a class="sourceLine" id="cb13-5" data-line-number="5">    <span class="dt">tstart =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb13-6" data-line-number="6">    <span class="dt">tstop =</span> <span class="dv">15</span>,</a>
<a class="sourceLine" id="cb13-7" data-line-number="7">    <span class="dt">u =</span> iniStates,</a>
<a class="sourceLine" id="cb13-8" data-line-number="8">    <span class="dt">tspan =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">14</span></a>
<a class="sourceLine" id="cb13-9" data-line-number="9">)</a>
<a class="sourceLine" id="cb13-10" data-line-number="10">sims</a></code></pre></div>
<pre><code>## &#39;SimBIID_runs&#39; object with n = 1 replicates.
## 
## Output at final time point:
## # A tibble: 1 x 6
##   completed     t     S     I     R    R1
##       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1         0    15    95     0     1   667
## 
## Time-series counts:
## # A tibble: 14 x 5
##        t     S     I     R    R1
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1     1   747    12     3     1
##  2     2   694    34    24    11
##  3     3   554   110    45    54
##  4     4   341   180   118   124
##  5     5   192   159   140   272
##  6     6   141    81   125   416
##  7     7   113    42    90   518
##  8     8   101    21    55   586
##  9     9    98     9    29   627
## 10    10    98     5    15   645
## 11    11    96     2     5   660
## 12    12    95     1     2   665
## 13    13    95     1     2   665
## 14    14    95     0     1   667</code></pre>
<p>Here we can see that the epidemic was still going at time point <code>t = 15</code>.</p>
</div>
<div id="plotting-simulations" class="section level2">
<h2><span class="header-section-number">2.4</span> Plotting simulations</h2>
<p>The <code>run()</code> method outputs a <code>SimBIID_runs</code> object, which can be plotted using the <code>plot()</code> function:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="co">## plot simulation</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="kw">plot</span>(sims)</a></code></pre></div>
<p><img src="_main_files/figure-html/sim-plot-1.svg" width="80%" style="display: block; margin: auto;" /></p>
</div>
<div id="running-multiple-simulations" class="section level2">
<h2><span class="header-section-number">2.5</span> Running multiple simulations</h2>
<p>We can run multiple simulations by passing a <code>nrep</code> argument to <code>run()</code>. For example, to run 100 replicates and plot them:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="co">## run model</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2">sims &lt;-<span class="st"> </span><span class="kw">run</span>(</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">    <span class="dt">model =</span> model,</a>
<a class="sourceLine" id="cb16-4" data-line-number="4">    <span class="dt">pars =</span> simPars,</a>
<a class="sourceLine" id="cb16-5" data-line-number="5">    <span class="dt">tstart =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb16-6" data-line-number="6">    <span class="dt">tstop =</span> <span class="dv">15</span>,</a>
<a class="sourceLine" id="cb16-7" data-line-number="7">    <span class="dt">u =</span> iniStates,</a>
<a class="sourceLine" id="cb16-8" data-line-number="8">    <span class="dt">tspan =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">14</span>,</a>
<a class="sourceLine" id="cb16-9" data-line-number="9">    <span class="dt">nrep =</span> <span class="dv">100</span></a>
<a class="sourceLine" id="cb16-10" data-line-number="10">)</a></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">sims</a></code></pre></div>
<pre><code>## &#39;SimBIID_runs&#39; object with n = 100 replicates.
## 
## Summaries of outputs at final time point:
##    completed          t                  S               I       
##  Min.   :0.00   Min.   : 0.06443   Min.   : 53.0   Min.   :0.00  
##  1st Qu.:0.00   1st Qu.: 2.22615   1st Qu.: 77.0   1st Qu.:0.00  
##  Median :1.00   Median :13.91501   Median : 93.0   Median :0.00  
##  Mean   :0.63   Mean   : 9.83262   Mean   :332.7   Mean   :0.29  
##  3rd Qu.:1.00   3rd Qu.:15.00000   3rd Qu.:761.2   3rd Qu.:0.00  
##  Max.   :1.00   Max.   :15.00000   Max.   :762.0   Max.   :7.00  
##        R               R1        
##  Min.   : 0.00   Min.   :  1.00  
##  1st Qu.: 0.00   1st Qu.:  1.75  
##  Median : 0.00   Median :666.00  
##  Mean   : 0.74   Mean   :429.26  
##  3rd Qu.: 1.00   3rd Qu.:684.00  
##  Max.   :17.00   Max.   :710.00</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="co">## plot simulations</span></a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="kw">plot</span>(sims, <span class="dt">quant =</span> <span class="kw">c</span>(<span class="fl">0.6</span>, <span class="fl">0.7</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>))</a></code></pre></div>
<pre><code>## Warning: `cols` is now required.
## Please use `cols = c(value)`</code></pre>
<p><img src="_main_files/figure-html/sim-run21-1.svg" width="80%" style="display: block; margin: auto;" /></p>
<p>Here the ribbons correspond to different prediction bands, and the red line is the posterior median. We can also add individual trajectories by inputing their replicate number, for example below we add the trajectories for replicates 1 and 2 to the plot.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="co">## plot simulations</span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2"><span class="kw">plot</span>(sims, <span class="dt">rep =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">quant =</span> <span class="kw">c</span>(<span class="fl">0.6</span>, <span class="fl">0.7</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>))</a></code></pre></div>
<pre><code>## Warning: `cols` is now required.
## Please use `cols = c(value)`</code></pre>
<p><img src="_main_files/figure-html/sim-plot1-1.svg" width="80%" style="display: block; margin: auto;" /></p>
<p>There is an argument in <code>run()</code> to enable parallel processing if required (if the <code>parallel</code> package is installed). See help file for <code>run()</code> (e.g. <code>?run</code>) for more details.</p>

</div>
</div>
<h3> References</h3>
<div id="refs" class="references">
<div id="ref-anonymous:1978">
<p>Anonymous. 1978. “Influenza in a Boarding School.” <em>British Medical Journal</em> 1: 578.</p>
</div>
<div id="ref-devriesetal:2006">
<p>de Vries, Gerda, Thomas Hillen, Mark Lewis, Johannes Mueller, and Birgitt Schöenfisch. 2006. <em>A Course in Mathematical Biology: Quantitative Modeling with Mathematical and Computational Methods</em>. Society for Industrial; Applied Mathematics.</p>
</div>
<div id="ref-murray:2003">
<p>Murray, J.D. 2003. <em>AMathematical Biology I - an Introduction</em>. 3rd ed. Springer.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="approximate-bayesian-computation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
